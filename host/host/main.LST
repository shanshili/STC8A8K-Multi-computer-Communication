C51 COMPILER V9.00   MAIN                                                                  12/07/2021 14:53:22 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: E:\keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "8A8K.h"
   2          #include "KEYBOARD.H"
   3          #include "DELAY.H"
   4          #include <INTRINS.H>
   5          sbit rs485re = P3^7;
   6          sbit rs485DE = P3^5;
   7          
   8          /*#include "lcd1602.h"
   9          
  10          mainframe 
  11          ä¸²å£1ï¼š9ä½æ•°æ®,å¯å˜æ³¢ç‰¹ç‡
  12          å®šæ—¶å™¨1:16ä½è‡ªåŠ¨é‡è½½ 
  13          ä¸²å£1é€‰æ‹©å®šæ—¶å™¨1ä¸ºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨
  14          æ³¢ç‰¹ç‡ï¼š9600
  15          RxD P3.0
  16          TxD P3.1
  17          */
  18          /* 
  19          TB8=0 send data
  20          TB8=1 send address
  21          */
  22          /*
  23          é€šè¿‡ä¸»æœºè®¾ç½®ä»æœºåœ°å€ï¼Œè®¾ç½®ä»æœºçš„é¢‘ç‡ã€å ç©ºæ¯”ã€æµæ°´ç¯èŠ±æ ·ã€‚
  24          ä¸»æœºé€šè¿‡é”®ç›˜è®¾ç½®ï¼ŒLCD12864æ˜¾ç¤ºã€‚
  25          */
  26          
  27          #define TXendtestLED P00
  28          #define TXendtestLEDADDR P02
  29          #define TXendtestLEDDATA P03
  30          #define uchar unsigned char //1byte
  31          #define uin32 unsigned int  //4byte
  32          unsigned int keyvalue = 0;
  33            
  34          unsigned char seg[] = {0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};
  35          
  36          void UartInit(void) //9600bps@24.000MHz
  37          { 
  38   1          P3M1 = 0X00;
  39   1          P3M0 = 0X03;
  40   1          P_SW1 = 0X00; //ç«¯å£æ˜ å°„ 3.0 3.1
  41   1          SCON = 0xD0;  //ä¸²å£æ§åˆ¶ï¼šä¸²å£1ï¼Œ9ä½æ•°æ®,å¯å˜æ³¢ç‰¹ç‡  1101 0000 å…è®¸ä¸²å£æ¥æ”¶æ•°æ
             -®ï¼Œå¤„äºåœ°å€å¸§ç­›é€‰è¢«ç¦æ­¢çŠ¶æ€ï¼Œæ¥æ”¶åˆ°çš„ä¿¡æ¯ç›´æ¥è¿›å…¥SBUFï¼Œä½¿RI=1
  42   1          PCON &= 0x7F; //ç”µæºç®¡ç†ï¼šæ³¢ç‰¹ç‡ä¸å€é€Ÿ PCON=0X00 SMOD=0
  43   1          AUXR &= 0xFE; //é€‰æ‹©æ³¢ç‰¹ç‡å‘ç”Ÿå™¨ï¼šå®šæ—¶å™¨1
  44   1          AUXR |= 0x40; //å®šæ—¶å™¨1æ—¶é’Ÿï¼šFosc,å³1T T1x12=1
  45   1          TMOD &= 0x0F; //å®šæ—¶å™¨1æ¨¡å¼é…ç½®ï¼šå®šæ—¶ï¼Œ16ä½è‡ªåŠ¨é‡è£…æ–¹å¼
  46   1          TL1 = 0x8F;   //è®¾å®šå®šæ—¶ä½å­—èŠ‚:
  47   1          TH1 = 0xFD;   //è®¾å®šå®šæ—¶é«˜å­—èŠ‚:  64911 65536-(SYSCLK/4/baud)
  48   1          ET1 = 0;      //å®šæ—¶å™¨1ä¸­æ–­ï¼šç¦æ­¢
  49   1          TR1 = 1;      //å¯åŠ¨å®šæ—¶å™¨1
  50   1      }
  51          /*
  52          void SEND_data(uchar *Buff)//å‘é€æ•°æ®å‡½æ•°
  53          {
  54              uchar i;
C51 COMPILER V9.00   MAIN                                                                  12/07/2021 14:53:22 PAGE 2   

  55              uchar lenth;
  56              uchar check;
  57              lenth=strlen(Buff); //è®¡ç®—æ•°æ®é•¿åº¦
  58              check=lenth;
  59          
  60              TI=0; 
  61              TB8=0; //å‘é€æ•°æ®å¸§
  62              SBUF=lenth;//å‘é€æ•°æ®é•¿åº¦
  63              while(!TI);
  64              TI=0;
  65          
  66              for(i=0;i<lenth;i++) //å‘é€æ•°æ®
  67              {
  68                  check=check^Buff[i];//^å¼‚æˆ–è¿ç®—ç¬¦
  69                  TB8=0;
  70                  SBUF=Buff[i];
  71                  while(!TI);
  72                  TI=0;
  73              }
  74          
  75              TB8=0; //å‘é€æ ¡éªŒå­—èŠ‚?
  76              SBUF=check;
  77              while(!TI);
  78              TI=0;
  79          }
  80          
  81          void ADDR_data(unsigned addr)//å‘æŒ‡å®šä»æœºåœ°å€å‘é€æ•°æ®
  82          {
  83              while(temp!=addr) //ä¸»æœºç­‰å¾…ä»æœºè¿”å›å…¶åœ°å€ä½œä¸ºåº”ç­”ä¿¡å·
  84              {
  85                  TI=0; //å‘é€ä»æœºåœ°å€
  86                  TB8=1; //åå¤å‘é€åœ°å€å¸§
  87                  SBUF=addr;
  88                  while(!TI);
  89                  TI=0;
  90                  RI=0;//åå¤æ¥æ”¶ï¼Œå¹¶æ¯”è¾ƒæ˜¯å¦ä¸ºåœ°å€
  91                  while(!RI);
  92                  temp=SBUF;
  93                  RI=0;
  94              }
  95              temp=_ERR_; //?
  96              while(temp!=_SUCC_)//ä¸»æœºç­‰å¾…ä»æœºæ•°æ®æ¥æ”¶æˆåŠŸä¿¡å·
  97              {
  98                  SEND_data(Buff);
  99                  RI=0;
 100                  while(!RI);
 101                  temp=SBUF;
 102                  RI=0;
 103              }
 104          }
 105          */
 106          
 107          void TXdata(uchar addr, uchar *str)
 108          {
 109   1          TB8 = 1;
 110   1          TB8 = 1;
 111   1          SBUF = addr;
 112   1      //    LCD_dischar(6, 0, addr);
 113   1          while (!TI); //finish sending put 1 //é—®é¢˜ï¼šä¸ç¡®å®šå¯¹æ–¹æ˜¯å¦æ¥å—åˆ°
 114   1          TI = 0;
 115   1        TXendtestLED = 1; //å·²å‘é€
 116   1        while(SBUF != (addr+0x01)); //æ¥æ”¶åˆ°ä»æœºå“åº”
C51 COMPILER V9.00   MAIN                                                                  12/07/2021 14:53:22 PAGE 3   

 117   1        Delay500ms();
 118   1        TXendtestLED = 0;//ä»æœºå·²æ¥å—
 119   1        Delay500ms();
 120   1          TB8 = 0;
 121   1          TB8 = 0;
 122   1          while (*str != '\0')
 123   1          {
 124   2              SBUF = (*str);
 125   2      //      LCD_disstr(7, 0, str);
 126   2              while (!TI);
 127   2              TI = 0;
 128   2              str++;
 129   2          }
 130   1          TXendtestLED = 1;  //å·²å‘é€å®Œ
 131   1      //  LCD_disstr(0, 1, "finished");
 132   1          Delay500ms();
 133   1      
 134   1      }
 135          
 136          /*
 137          æŒ‰é”®æ§åˆ¶æ¥æ”¶æ•°æ®çš„ä»æœºï¼šæŒ‰é”®ã€ä¸­æ–­
 138          æ˜¾ç¤ºå‘é€çš„æ•°æ®ï¼ˆè½¬æ¢ä¸º10è¿›åˆ¶ï¼‰
 139          æŒ‰é”®è¾“å…¥è¦å‘é€çš„æ•°æ®
 140          verup:
 141          æµ‹é‡æ•°æ®ï¼Œå¤šçº§æ˜¾ç¤º
 142          */
 143          void main()
 144          {
 145   1          uin32 addr;
 146   1          uchar str[] = {0};
 147   1          /*
 148   1          uin32 keyvalue = 0; //å¯åœ¨å…¶ä»–æ¨¡å—è°ƒç”¨çš„å…¨å±€å˜é‡çš„åˆå§‹åŒ–//debug:è¯¥å˜é‡ä¸ºå¤šå¤„è°ƒ
             -ç”¨çš„å…¨å±€å˜é‡ï¼Œæ³¨æ„ä¸è¦å†æ¬¡å£°æ˜å’Œå¤åˆ¶
 149   1          P2M1 = 0X00;
 150   1          P2M0 = 0X00; //å› ä¸ºè¦è¯»å–çŠ¶æ€å­— ï¼Œæ‰€ä»¥åªèƒ½æ˜¯å¼±ä¸Šæ‹‰ï¼šå‡†åŒå‘       
 151   1          P3M1 = 0X00;
 152   1          P3M0 = 0Xe0;
 153   1          LCD_init();
 154   1          LCD_disstr(0, 1,"opening");
 155   1          */
 156   1      
 157   1          Delay500ms();
 158   1          UartInit();
 159   1          rs485re = 0;
 160   1          rs485DE = 1;
 161   1          while (1)
 162   1          {
 163   2              TXendtestLED = 0;
 164   2              TXendtestLEDADDR = 0;
 165   2              TXendtestLEDDATA = 0;
 166   2      //        LCD_disstr(0, 1, "address");
 167   2              Keyboardmain(); //å†™æˆä¸­æ–­ï¼Œéšæ—¶å¯è¾“å…¥åœ°å€å’Œæ•°æ®
 168   2              addr = keyvalue;
 169   2              P2=seg[addr];
 170   2              TXendtestLEDADDR = 1;
 171   2      //        LCD_disstr(0, 1, "data");
 172   2              Keyboardmain();
 173   2              str[0] = keyvalue;
 174   2              P2=seg[*str];
 175   2              TXendtestLEDDATA = 1;
 176   2              Delay500ms();
 177   2              TXdata(addr, str); //ç›´æ¥è°ƒç”¨å‡½æ•°å//æŸ¥è¯¢æ³•
C51 COMPILER V9.00   MAIN                                                                  12/07/2021 14:53:22 PAGE 4   

 178   2          }
 179   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    209    ----
   CONSTANT SIZE    =      1    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12       7
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
